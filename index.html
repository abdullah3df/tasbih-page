<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>ØªØ³Ø¨ÙŠØ­ â€” Ø´Ø§Ø±Ùƒ Ø§Ù„Ø£Ø¬Ø±</title>
<meta name="description" content="Ø§Ø°ÙƒØ± Ø§Ù„Ù„Ù‡ Ø¹Ø´Ø± Ù…Ø±Ø§Øª Ø«Ù… Ø´Ø§Ø±Ùƒ Ø§Ù„Ø£Ø¬Ø± Ø¨Ø¥Ø±Ø³Ø§Ù„ Ø±Ø§Ø¨Ø· Ø§Ù„ØµÙØ­Ø©.">
<meta name="theme-color" content="#0e1c1a">

<!-- Ø®Ø·ÙˆØ· Ø¬Ù…ÙŠÙ„Ø©: Cairo Ù„Ù„Ù†ØµÙˆØµ Ùˆ Amiri Quran Ù„Ù„Ø¢ÙŠØ© -->
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Amiri+Quran&family=Cairo:wght@400;700;900&display=swap" rel="stylesheet">

<style>
  :root{
    --bg1:#0c1716; --bg2:#112927; --card:#0f2321; --edge:#1b3f3a;
    --text:#eaf7f5; --muted:#a6c8c1; --ring:#183a36;
    --accent:#25c3a7; --accent2:#89f3df; --share:#1fa855;
  }
  *{box-sizing:border-box}
  body{
    margin:0; min-height:100dvh; display:grid; place-items:center;
    color:var(--text); font-family:"Cairo", system-ui, -apple-system, "Segoe UI", Roboto, Arial;
    background:
      radial-gradient(900px 600px at 100% -10%, #1a5e54 0, #0000 60%),
      radial-gradient(900px 700px at -10% 120%, #14433f 0, #0000 60%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    overflow-x:hidden;
  }

  /* Ø´Ø§Ø´Ø© Ø§Ù„Ø§ÙØªØªØ§Ø­ */
  .splash{
    position:fixed; inset:0; display:grid; place-items:center; z-index:10;
    background:
      radial-gradient(900px 600px at 100% -10%, #163d37 0, #0000 60%),
      linear-gradient(180deg,#0b1615,#0e1f1d);
    animation: fadeIn .5s ease both;
  }
  .ayah{
    text-align:center; padding:22px 26px; border-radius:20px;
    border:1px solid #214b44; background:linear-gradient(180deg,#0e201e,#0f2321);
    box-shadow:0 18px 50px #0006; max-width:min(92vw,640px);
  }
  .ayah h2{ margin:0 0 8px; font:400 1.8rem "Amiri Quran", serif }
  .ayah .src{color:var(--muted); font-weight:700}
  .fade-out{ animation: fadeOut .8s ease forwards }
  @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
  @keyframes fadeOut{ to{opacity:0; transform:scale(1.02)} }

  /* Ø­Ø§ÙˆÙŠØ§Øª */
  .wrap{ width:min(96vw,680px); padding:22px; opacity:0; transform:translateY(12px); transition:.6s ease }
  .wrap.ready{ opacity:1; transform:translateY(0) }
  .card{
    background:linear-gradient(180deg,#0e201e,var(--card));
    border:1px solid var(--edge); border-radius:24px; padding:26px;
    box-shadow:0 20px 60px #0007;
  }
  h1{margin:0 0 8px; font-size:1.35rem; text-align:center; font-weight:900}
  .sub{margin:0 0 10px; color:var(--muted); text-align:center}
  .phrase{ text-align:center; font-weight:900; line-height:2; margin:10px 0 14px; font-size:1.2rem; min-height:2.4em }

  /* Ø§Ù„Ø²Ø± Ø§Ù„ÙƒØ¨ÙŠØ± (Ø§Ù„ØªØ³Ø¨ÙŠØ­) */
  .big{
    margin:14px auto; width:min(76vw,320px); height:min(76vw,320px); max-width:320px; max-height:320px;
    border-radius:50%; border:none; color:inherit; cursor:pointer; display:grid; place-items:center;
    background:conic-gradient(var(--accent) 0deg, var(--accent2) var(--deg), var(--ring) var(--deg));
    transition:background .25s ease, transform .12s ease, filter .2s ease;
    box-shadow:0 16px 44px #0006, inset 0 0 0 10px #13302c, inset 0 0 0 1px #265d55;
  }
  .big:active{ transform:translateY(1px) scale(.992) }
  .inner{
    width:86%; height:86%; border-radius:50%; display:grid; place-items:center; text-align:center; padding:14px;
    background:linear-gradient(180deg,#0d1e1c,#112725); border:1px solid #1f4c45;
  }
  .label{font-size:1.6rem;font-weight:900}
  .subtle{font-size:1rem;color:var(--muted);margin-top:6px}

  /* ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© */
  .end{ display:none }
  .end.visible{ display:block }
  .end .only-card{
    background:linear-gradient(180deg,#0e201e,var(--card));
    border:1px solid var(--edge); border-radius:24px; padding:28px;
    box-shadow:0 20px 60px #0007; text-align:center;
  }
  .end h2{ margin:0 0 8px; font-weight:900 }
  .visits{ font-size:1.1rem; color:var(--muted); margin:6px 0 16px }

  /* Ø²Ø± Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ© Ø§Ù„Ù…Ø³ØªØ­ÙŠÙ„ 3D */
  .bigShare{
    margin:10px auto; width:min(80vw,340px); height:min(80vw,340px); max-width:340px; max-height:340px;
    border-radius:50%; border:none; color:#fff; cursor:pointer; display:grid; place-items:center;
    font-size:1.35rem; font-weight:900;
    background:linear-gradient(145deg,#1cc46f,#10a557);
    box-shadow:
      12px 12px 22px #0a3b27cc,
      -12px -12px 22px #1fd68033,
      inset 10px 10px 18px rgba(0,0,0,.35),
      inset -10px -10px 18px rgba(255,255,255,.07);
    filter: drop-shadow(0 10px 25px #0c3a2777);
  }

  .stats{display:flex;gap:10px;justify-content:center;margin-top:10px}
  .pill{min-width:140px;text-align:center;padding:10px 12px;border-radius:999px;background:#0f2422;border:1px solid var(--edge);font-weight:800}

  @media (prefers-reduced-motion: reduce){
    .wrap{transition:none}
    .splash,.fade-out{animation:none}
  }
</style>
</head>
<body>

<!-- Splash -->
<div id="splash" class="splash" aria-hidden="true">
  <div class="ayah">
    <h2>ï´¿ Ø³ÙØ¨Ù‘ÙØ­Ù Ø§Ø³Ù’Ù…Ù Ø±ÙØ¨Ù‘ÙÙƒÙ Ø§Ù„Ø£ÙØ¹Ù’Ù„ÙÙ‰ ï´¾</h2>
    <div class="src">Ø³ÙˆØ±Ø© Ø§Ù„Ø£Ø¹Ù„Ù‰ â€¢ Ø¢ÙŠØ© Ù¡</div>
  </div>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„ØªØ·Ø¨ÙŠÙ‚ -->
<div id="app" class="wrap">
  <div class="card" id="mainCard">
    <h1>ØªØ³Ø¨ÙŠØ­ ÙˆØ°ÙƒØ± Ø§Ù„Ù„Ù‡</h1>
    <p class="sub">Ø§Ø¶ØºØ· Ø§Ù„Ø²Ø± Ù„Ù„ØªØ³Ø¨ÙŠØ­ 10 Ù…Ø±Ø§ØªØŒ Ø«Ù… Ø´Ø§Ø±Ùƒ Ø§Ù„Ø£Ø¬Ø± Ù…Ø¹ Ø£ØµØ¯Ù‚Ø§Ø¦Ùƒ</p>

    <div id="phrase" class="phrase">Ø§Ø¨Ø¯Ø£ Ø¨Ø§Ù„Ø¶ØºØ· Ø¹Ù„Ù‰ Ø§Ù„Ø²Ø±.</div>

    <button id="big" class="big" style="--deg:0deg" aria-label="Ø²Ø± Ø§Ù„ØªØ³Ø¨ÙŠØ­">
      <div class="inner">
        <div id="label" class="label">Ø§Ø¶ØºØ· Ù‡Ù†Ø§</div>
        <div class="subtle">Ø§Ù„Ù…ØªØ¨Ù‚ÙŠ: <span id="left">10</span> / 10</div>
      </div>
    </button>

    <div class="stats">
      <div class="pill">Ø§Ù„Ø¹Ø¯Ù‘Ø§Ø¯: <span id="count">0</span></div>
      <div class="pill">Ø§Ù„Ù…Ø´Ø§Ø±ÙƒØ§Øª: <span id="shares">0</span></div>
    </div>
  </div>
</div>

<!-- ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© (ÙÙ‚Ø· Ø²Ø± Ù…Ø´Ø§Ø±ÙƒØ© + Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø±) -->
<div id="end" class="wrap end">
  <div class="only-card">
    <h2>Ø¬Ø²Ø§Ùƒ Ø§Ù„Ù„Ù‡ Ø®ÙŠØ±Ù‹Ø§</h2>
    <div class="visits">Ø²Ø§Ø¦Ø±ÙˆØ§ Ø§Ù„ØµÙØ­Ø©: <b id="visitors">â€”</b></div>
    <button id="shareOnly" class="bigShare" aria-label="Ù…Ø´Ø§Ø±ÙƒØ© Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨">ğŸ“¤ Ø´Ø§Ø±Ùƒ Ø§Ù„Ø£Ø¬Ø± Ø¹Ù„Ù‰ ÙˆØ§ØªØ³Ø§Ø¨</button>
  </div>
</div>

<script>
(function(){
  /* === Ø¶Ø¹ Ù‡Ù†Ø§ Ø±Ø§Ø¨Ø· ØµÙØ­ØªÙƒ Ø§Ù„Ø­Ù‚ÙŠÙ‚ÙŠ === */
  const SHARE_URL = "https://example.com/your-page"; // â† Ø¹Ø¯Ù‘Ù„ Ù‡Ø°Ø§ Ù„Ù„Ø±Ø§Ø¨Ø· Ø§Ù„Ù†Ù‡Ø§Ø¦ÙŠ

  // Splash
  const splash = document.getElementById('splash');
  const app = document.getElementById('app');
  setTimeout(()=>{ splash.classList.add('fade-out'); }, 2000);
  setTimeout(()=>{ splash.remove(); app.classList.add('ready'); }, 2800);

  // Ø¹Ù†Ø§ØµØ± Ø§Ù„ØªØ·Ø¨ÙŠÙ‚
  const big = document.getElementById('big');
  const label = document.getElementById('label');
  const leftEl = document.getElementById('left');
  const countEl = document.getElementById('count');
  const sharesEl = document.getElementById('shares');
  const phraseEl = document.getElementById('phrase');

  // ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
  const endWrap = document.getElementById('end');
  const visitorsEl = document.getElementById('visitors');
  const shareOnlyBtn = document.getElementById('shareOnly');
  const mainCard = document.getElementById('mainCard');

  // Ø­Ø§Ù„Ø©
  let target=10, left=10, count=0, shareMode=false, lastTap=0;
  let shares= +localStorage.getItem('tasbih_shares_final') || 0;
  sharesEl.textContent = shares;

  // Ø§Ù„ØµÙˆØª (WebAudio)
  let audioCtx=null;
  function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
  function beep(freq=760, dur=90, vol=0.07){
    try{
      ensureAudio();
      const o=audioCtx.createOscillator(), g=audioCtx.createGain();
      o.type='sine'; o.frequency.value=freq; g.gain.value=vol;
      o.connect(g).connect(audioCtx.destination);
      const t=audioCtx.currentTime; o.start(t);
      g.gain.exponentialRampToValueAtTime(0.0001, t+dur/1000); o.stop(t+dur/1000+0.02);
    }catch(_){}
  }
  function chime(){ [523,659,784].forEach((f,i)=>setTimeout(()=>beep(f,120,0.12), i*140)); }
  window.addEventListener('pointerdown', ()=>{ try{ensureAudio();}catch(_){} }, {once:true});

  function setProgress(){ big.style.setProperty('--deg', ((target-left)/target)*360 + 'deg'); }
  function updateUI(){
    leftEl.textContent = left; countEl.textContent = count; setProgress();
    if(left===0 && !shareMode){
      shareMode=true; // Ù†Ù†ØªÙ‚Ù„ Ø¥Ù„Ù‰ ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
      chime();
      if(navigator.vibrate) navigator.vibrate(40);
      showEndPage();
    }
  }

  // Ù…Ø´Ø§Ø±ÙƒØ© ÙˆØ§ØªØ³Ø§Ø¨ ÙÙ‚Ø· (ÙŠØ±Ø³Ù„ Ø§Ù„Ø±Ø§Ø¨Ø· ÙÙ‚Ø·)
  function openWhatsApp(){
    const url = "https://wa.me/?text=" + encodeURIComponent(SHARE_URL);
    window.open(url, "_blank", "noopener");
    shares++; localStorage.setItem('tasbih_shares_final', shares);
    sharesEl.textContent = shares;
  }

  // ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©: Ø¥Ø¸Ù‡Ø§Ø± + Ø¬Ù„Ø¨ Ø¹Ø¯Ø¯ Ø§Ù„Ø²ÙˆØ§Ø± (ØªÙ‚Ø±ÙŠØ¨ÙŠ)
  async function showEndPage(){
    // Ø¥Ø®ÙØ§Ø¡ Ø§Ù„Ø¨Ø·Ø§Ù‚Ø© Ø§Ù„Ø±Ø¦ÙŠØ³ÙŠØ© ÙˆØ¹Ø±Ø¶ ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ© ÙÙ‚Ø·
    app.style.display = "none";
    endWrap.classList.add('ready','visible');

    // Ù…ÙØªØ§Ø­ Ø§Ù„Ø¹Ø¯Ø§Ø¯ Ù…Ø¨Ù†ÙŠ Ø¹Ù„Ù‰ Ø§Ù„Ø¯ÙˆÙ…ÙŠÙ†/Ø§Ù„Ù…Ø³Ø§Ø± Ø§Ù„Ø­Ø§Ù„ÙŠ Ø­ØªÙ‰ ÙŠÙƒÙˆÙ† ÙØ±ÙŠØ¯Ù‹Ø§
    const COUNTER_NS  = "tasbih";
    const COUNTER_KEY = (location.hostname + location.pathname)
                        .replace(/[^a-z0-9]/gi,'-')
                        .replace(/-+/g,'-')
                        .toLowerCase() || "root";

    // Ø¹Ø¯Ù… ØªÙƒØ±Ø§Ø± Ø¹Ø¯Ù‘ Ù†ÙØ³ Ø§Ù„Ø¬Ù‡Ø§Ø²
    const visitedKey = 'visited_once_v1';
    let endpoint = '';
    try{
      const visited = localStorage.getItem(visitedKey);
      if(!visited){
        endpoint = `https://api.countapi.xyz/hit/${encodeURIComponent(COUNTER_NS)}/${encodeURIComponent(COUNTER_KEY)}`;
        localStorage.setItem(visitedKey, '1');
      }else{
        endpoint = `https://api.countapi.xyz/get/${encodeURIComponent(COUNTER_NS)}/${encodeURIComponent(COUNTER_KEY)}`;
      }
      const res = await fetch(endpoint);
      const data = await res.json();
      if(typeof data.value === 'number'){ visitorsEl.textContent = data.value.toLocaleString('ar-EG'); }
      else { visitorsEl.textContent = 'â€”'; }
    }catch(e){
      visitorsEl.textContent = 'â€”';
    }
  }

  function tap(){
    const now = Date.now();
    if(now - lastTap < 100) return; // Ù…Ù†Ø¹ Ù†Ù‚Ø± Ù…Ø²Ø¯ÙˆØ¬ Ø³Ø±ÙŠØ¹
    lastTap = now;

    if(shareMode){ return; } // Ù†Ø­Ù† ÙÙŠ ØµÙØ­Ø© Ø§Ù„Ù†Ù‡Ø§ÙŠØ©
    if(left>0){
      count++; left--;
      phraseEl.textContent = ["Ø³ÙØ¨Ø­Ø§Ù†Ù Ø§Ù„Ù„Ù‡","ÙˆØ§Ù„Ø­Ù…Ø¯Ù Ù„Ù„Ù‡","ÙˆÙ„Ø§ Ø¥Ù„Ù‡Ù Ø¥Ù„Ø§ Ø§Ù„Ù„Ù‡","ÙˆØ§Ù„Ù„Ù‡Ù Ø£ÙƒØ¨Ø±"][(count-1)%4];
      if(navigator.vibrate) navigator.vibrate(18);
      beep(700+Math.random()*60,70,0.08);
      updateUI();
    }
  }

  big.addEventListener('click', tap);
  shareOnlyBtn.addEventListener('click', openWhatsApp);

  updateUI();
})();
</script>
</body>
</html>
