<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>تسبيح — عشر ثم شارك الأجر</title>
<meta name="theme-color" content="#0c1716">
<style>
  :root{
    --bg1:#0c1716; --bg2:#112927; --card:#0f2321; --edge:#1b3f3a;
    --text:#eaf7f5; --muted:#a6c8c1; --ring:#183a36;
    --accent:#25c3a7; --accent2:#89f3df; --share:#1fa855;
  }
  *{box-sizing:border-box;font-family:system-ui,-apple-system,"Segoe UI",Roboto,Arial}
  body{
    margin:0; min-height:100dvh; display:grid; place-items:center; color:var(--text);
    background:
      radial-gradient(900px 600px at 100% -10%, #1a5e54 0, #0000 60%),
      radial-gradient(900px 700px at -10% 120%, #14433f 0, #0000 60%),
      linear-gradient(180deg,var(--bg1),var(--bg2));
    overflow:hidden;
  }

  /* ========== Splash ========== */
  .splash{
    position:fixed; inset:0; display:grid; place-items:center; z-index:10;
    background:
      radial-gradient(900px 600px at 100% -10%, #163d37 0, #0000 60%),
      linear-gradient(180deg,#0b1615,#0e1f1d);
    animation: fadeIn .6s ease both;
  }
  .ayah{
    text-align:center; padding:24px; border-radius:22px;
    border:1px solid #214b44; background:linear-gradient(180deg,#0e201e,#0f2321);
    box-shadow:0 18px 50px #0006;
  }
  .ayah h2{
    margin:0 0 8px; font-weight:900; font-size:1.6rem; letter-spacing:.3px;
    animation: glow 1.8s ease-in-out infinite alternate;
  }
  .ayah .src{color:var(--muted); font-weight:700}
  .fade-out{ animation: fadeOut .7s ease forwards; }
  @keyframes fadeIn{ from{opacity:0} to{opacity:1} }
  @keyframes fadeOut{ to{opacity:0; transform:scale(1.02)} }
  @keyframes glow{
    from{ text-shadow:0 0 0 #89f3df; }
    to  { text-shadow:0 0 14px #89f3df55, 0 0 28px #25c3a755; }
  }

  /* ========== App Card ========== */
  .wrap{ width:min(96vw,640px); padding:22px; opacity:0; transform:translateY(12px); transition:.6s ease; }
  .wrap.ready{ opacity:1; transform:translateY(0); }
  .card{
    background:linear-gradient(180deg,#0e201e,var(--card));
    border:1px solid var(--edge); border-radius:24px; padding:24px;
    box-shadow:0 20px 60px #0007;
  }
  h1{margin:0 0 8px; font-size:1.15rem; color:var(--muted); text-align:center}
  .phrase{ text-align:center; font-weight:900; line-height:2; margin:10px 0 14px; font-size:1.2rem; min-height:2.4em }

  /* الزر الدائري */
  .big{
    margin:14px auto; width:240px; height:240px; border-radius:50%;
    position:relative; display:grid; place-items:center; cursor:pointer;
    background:conic-gradient(var(--accent) 0deg, var(--accent2) var(--deg), var(--ring) var(--deg));
    transition:background .25s ease, transform .12s ease, width .2s ease, height .2s ease;
    box-shadow:0 16px 44px #0006, inset 0 0 0 8px #13302c, inset 0 0 0 1px #265d55;
    user-select:none; border:none; color:inherit;
  }
  .big:active{ transform:translateY(1px) scale(.995); }
  .inner{
    width:86%; height:86%; border-radius:50%; display:grid; place-items:center; text-align:center; padding:12px;
    background:linear-gradient(180deg,#0d1e1c,#112725); border:1px solid #1f4c45;
  }
  .label{font-size:1.25rem;font-weight:900}
  .subtle{font-size:.95rem;color:var(--muted);margin-top:6px}

  .big.share{ width:280px; height:280px;
    background:conic-gradient(var(--share) 0deg, #55d78e var(--deg), #164c32 var(--deg));
    box-shadow:0 20px 50px #0008, inset 0 0 0 8px #0f3b28, inset 0 0 0 1px #178a4c;
  }
  .big.share .label{font-size:1.35rem}

  .stats{display:flex;gap:10px;margin-top:12px}
  .pill{flex:1;text-align:center;padding:10px 12px;border-radius:999px;background:#0f2422;border:1px solid var(--edge);font-weight:800}
  .ok{ color:#9ff3e4; font-size:.9rem; text-align:center; margin-top:8px; min-height:1.2em }
</style>
</head>
<body>

  <!-- Splash -->
  <div id="splash" class="splash">
    <div class="ayah">
      <h2>﴿ سَبِّحِ اسْمَ رَبِّكَ الأَعْلَى ﴾</h2>
      <div class="src">سورة الأعلى • آية 1</div>
    </div>
  </div>

  <!-- App -->
  <div id="app" class="wrap">
    <div class="card">
      <h1>اذكر الله — عشر تسبيحات ثم شارك الأجر</h1>

      <div id="phrase" class="phrase">ابدأ: اضغط الزر الكبير للتسبيح.</div>

      <button id="big" class="big" style="--deg:0deg" aria-label="زر التسبيح">
        <div class="inner">
          <div id="label" class="label">سَبِّح</div>
          <div class="subtle">المتبقي: <span id="left">10</span> / 10</div>
        </div>
      </button>

      <div class="stats">
        <div class="pill">العدّاد: <span id="count">0</span></div>
        <div class="pill">المشاركات: <span id="shares">0</span></div>
      </div>

      <div id="msg" class="ok"></div>
    </div>
  </div>

<script>
(function(){
  // ===== Splash transition =====
  const splash = document.getElementById('splash');
  const appWrap = document.getElementById('app');
  setTimeout(()=>{ splash.classList.add('fade-out'); }, 2200);       // بقاء الآية ~2.2ث
  setTimeout(()=>{ splash.remove(); appWrap.classList.add('ready'); }, 3000);

  // ===== App logic =====
  const SHARE_LINK = "https://share.google/y1S9s1xfewux5ikaA";

  const phrases = ["سُبحانَ الله","والحمدُ لله","ولا إلهَ إلا الله","واللهُ أكبر"];
  const invite  = `تسبيح - مشاركة الأجر\n${SHARE_LINK}`;

  const big = document.getElementById('big');
  const label = document.getElementById('label');
  const phraseEl = document.getElementById('phrase');
  const leftEl = document.getElementById('left');
  const countEl = document.getElementById('count');
  const sharesEl = document.getElementById('shares');
  const msg = document.getElementById('msg');

  let target=10, left=10, count=0, shareMode=false;
  let shares= +localStorage.getItem('tasbih_shares_link') || 0;
  sharesEl.textContent = shares;

  // خفّة صوتية لطيفة (بدون ملفات، باستخدام WebAudio)
  let audioCtx=null;
  function ensureAudio(){ if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)(); }
  function beep(freq=760, dur=90, vol=0.08){
    ensureAudio();
    const o=audioCtx.createOscillator(), g=audioCtx.createGain();
    o.type='sine'; o.frequency.value=freq; g.gain.value=vol;
    o.connect(g).connect(audioCtx.destination);
    const t=audioCtx.currentTime; o.start(t);
    g.gain.exponentialRampToValueAtTime(0.0001, t+dur/1000); o.stop(t+dur/1000+0.02);
  }
  function chime(){ [523,659,784].forEach((f,i)=>setTimeout(()=>beep(f,120,0.12), i*140)); }

  function setProgress(){ big.style.setProperty('--deg', ((target-left)/target)*360 + 'deg'); }
  function updateUI(){
    leftEl.textContent = left; countEl.textContent = count; setProgress();
    if(left===0 && !shareMode){
      shareMode=true; big.classList.add('share'); label.textContent="شارك الأجر";
      phraseEl.textContent="أحسنت! اضغط للمشاركة على واتساب."; chime();
      if(navigator.vibrate) navigator.vibrate(40);
    }
  }
  function flash(t){ msg.textContent=t; clearTimeout(flash._t); flash._t=setTimeout(()=>msg.textContent="",2200); }

  function shareLink(){
    // 1) Web Share (يرسل النص + الرابط) إن توفر
    if(navigator.share){
      navigator.share({ text: invite })
       .then(()=>afterShare()).catch(()=>{});
      return;
    }
    // 2) واتساب مع الرابط
    const url = "https://wa.me/?text=" + encodeURIComponent(invite);
    window.open(url, "_blank");
    afterShare();
  }
  function afterShare(){
    shares++; localStorage.setItem('tasbih_shares_link', shares);
    sharesEl.textContent = shares; flash("بارك الله فيك — تمت المشاركة.");
    // إعادة العدّ
    shareMode=false; left=10; count=0; big.classList.remove('share');
    label.textContent="سَبِّح"; phraseEl.textContent="ابدأ: اضغط الزر الكبير للتسبيح."; setProgress(); updateUI();
  }

  function onTap(){
    if(shareMode){ shareLink(); return; }
    if(left>0){
      count++; left--;
      phraseEl.textContent = phrases[(count-1)%phrases.length];
      if(navigator.vibrate) navigator.vibrate(18);
      try{ beep(700+Math.random()*60,70,0.08);}catch(_){}
      updateUI(); flash(`زاد الذِكر — المتبقي: ${left}`);
    }
  }

  big.addEventListener('click', onTap);
  // تفعيل الصوت عند أول تفاعل (قيود المتصفحات)
  window.addEventListener('pointerdown', ()=>{ try{ensureAudio();}catch(_){} }, {once:true});

  updateUI();
})();
</script>
</body>
</html>
