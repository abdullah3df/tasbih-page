<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>تسبيح — شارك الأجر</title>
<style>
body {
  margin: 0;
  font-family: 'Tahoma', sans-serif;
  background: linear-gradient(135deg, #e0f7e9, #c3f0d0);
  text-align: center;
  color: #222;
}

/* صفحة البداية */
#splash {
  position: fixed; top:0; left:0; width:100%; height:100%;
  display: flex; flex-direction: column; justify-content: center; align-items: center;
  background: linear-gradient(135deg, #dffae7, #b8f1c5);
  font-size: 1.5rem; font-weight: bold;
  animation: fadeIn 1s ease forwards;
  z-index: 10;
}
#splash.hidden { display: none; }
#splash p { margin: 10px 0; font-size: 1.6rem; }

@keyframes fadeIn {
  from { opacity: 0; }
  to { opacity: 1; }
}

/* صفحة التسبيح */
#main {
  padding: 20px;
}
#dhikrText {
  font-weight: 900;
  font-size: 1.4rem;
  margin: 10px 0 20px;
  opacity: 0;
  transform: scale(0.9);
  transition: all 0.3s ease;
}
#dhikrText.show {
  opacity: 1;
  transform: scale(1);
}
.count {
  font-size: 1.2rem;
  margin: 10px 0;
}
.ctaBtn {
  padding: 14px 28px;
  background: linear-gradient(135deg,#1cc46f,#10a557);
  color: #fff;
  border: none;
  border-radius: 14px;
  font-weight: bold;
  font-size: 1.1rem;
  cursor: pointer;
  transition: transform .1s ease;
}
.ctaBtn:active { transform: scale(0.98); }

/* صفحة النهاية */
#end {
  display: none;
  padding: 20px;
}
.shareBtn {
  padding: 14px 28px;
  background: #25D366;
  color: #fff;
  border: none;
  border-radius: 14px;
  font-weight: bold;
  font-size: 1.1rem;
  cursor: pointer;
}
</style>
</head>
<body>

<!-- صفحة البداية -->
<div id="splash">
  <p>بسم الله الرحمن الرحيم</p>
  <p>سَبِّحِ اسْمَ رَبِّكَ الْأَعْلَى</p>
</div>

<!-- صفحة التسبيح -->
<div id="main" style="display:none;">
  <div id="dhikrText"></div>
  <div class="count">الضغطات المتبقية: <span id="pressCount">10</span></div>
  <div class="count">عدد المشاركات: <span id="shareCount">0</span></div>
  <button id="ctaBtn" class="ctaBtn">اضغط هنا</button>
</div>

<!-- صفحة النهاية -->
<div id="end">
  <p>عدد الزوار: <span id="visitorCount">0</span></p>
  <button class="shareBtn" id="shareBtn">📤 شارك عبر واتساب</button>
</div>

<script>
// صفحة البداية
setTimeout(() => {
  document.getElementById('splash').classList.add('hidden');
  document.getElementById('main').style.display = 'block';
}, 3000);

let pressCount = 10;
let shareCount = localStorage.getItem('shareCount') || 0;
document.getElementById('shareCount').textContent = shareCount;

let firstShown = false;

// صوت عند الضغط
function playBeep(){
  const ctx = new (window.AudioContext || window.webkitAudioContext)();
  const osc = ctx.createOscillator();
  osc.type = 'sine';
  osc.frequency.setValueAtTime(800, ctx.currentTime);
  osc.connect(ctx.destination);
  osc.start();
  osc.stop(ctx.currentTime + 0.1);
}

document.getElementById('ctaBtn').addEventListener('click', () => {
  playBeep();

  if(!firstShown){
    firstShown = true;
    const txt = document.getElementById('dhikrText');
    txt.textContent = "سبحان الله والحمد لله ولا إله إلا الله والله أكبر";
    txt.classList.add('show');
  } else {
    const txt = document.getElementById('dhikrText');
    txt.classList.remove('show');
    void txt.offsetWidth; // إعادة تشغيل الأنيميشن
    txt.classList.add('show');
  }

  pressCount--;
  document.getElementById('pressCount').textContent = pressCount;

  if(pressCount === 0){
    document.getElementById('main').style.display = 'none';
    document.getElementById('end').style.display = 'block';
    updateVisitors();
  }
});

// زر المشاركة
document.getElementById('shareBtn').addEventListener('click', () => {
  shareCount++;
  localStorage.setItem('shareCount', shareCount);
  const msg = encodeURIComponent("تسبيح — شارك الأجر https://share.google/CxJR0KYYtNoNKd8Xs");
  window.open(`https://wa.me/?text=${msg}`, '_blank');
});

// عداد الزوار
function updateVisitors(){
  fetch('https://api.countapi.xyz/hit/tasbeeh_page/visitors')
    .then(res => res.json())
    .then(data => {
      document.getElementById('visitorCount').textContent = data.value;
    });
}
</script>

</body>
</html>
