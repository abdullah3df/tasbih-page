<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="utf-8" />
<meta name="viewport" content="width=device-width,initial-scale=1" />
<title>تسبيح — شارك الأجر</title>
<style>
  :root{
    --bg:#0f1c1a; --bg2:#112624; --card:#0f2321; --edge:#1a3c37;
    --text:#eef8f6; --muted:#a8c9c2; --btn1:#1cc46f; --btn2:#10a557;
  }
  *{box-sizing:border-box;-webkit-tap-highlight-color:transparent}
  body{
    margin:0;min-height:100dvh;display:grid;place-items:center;
    font-family:system-ui,-apple-system,"Segoe UI",Arial;color:var(--text);
    background:linear-gradient(180deg,var(--bg),var(--bg2));
  }
  .wrap{width:min(96vw,780px);padding:22px;display:none}
  /* ← ضمان ظهور صفحة البداية دائمًا */
  #start{display:block}
  .card{
    background:linear-gradient(180deg,#102422,var(--card));
    border:1px solid var(--edge);border-radius:22px;padding:22px;text-align:center;
    box-shadow:0 20px 60px #0008;
  }
  h1{margin:0 0 10px;font-weight:900;font-size:clamp(1.1rem,2.6vw,1.4rem)}
  .muted{color:var(--muted)}
  .btn{
    display:inline-block;border:none;cursor:pointer;
    background:linear-gradient(145deg,var(--btn1),var(--btn2));color:#fff;
    padding:12px 20px;border-radius:12px;font-weight:900;box-shadow:0 10px 24px #0a3b27aa;
  }
  .ring{
    width:min(74vw,300px);height:min(74vw,300px);border-radius:50%;
    margin:14px auto;background:conic-gradient(#34e3b0 var(--deg,0deg), #173a35 var(--deg,0deg));
    display:grid;place-items:center;color:#fff;font-weight:900;
    border:10px solid #13302c; box-shadow:inset 0 0 0 1px #265d55, 0 14px 36px #0007;
    user-select:none; cursor:pointer; transition:transform .08s ease;
  }
  .ring:active{transform:scale(.99)}
  #dhikrText{
    margin:8px auto 12px; line-height:1.8; text-align:center;
    font-size:0; opacity:0; transform:translateY(-6px);
    transition:opacity .25s, transform .25s, font-size .25s; min-height:3.2em;
  }
  #dhikrText.show{font-size:clamp(.9rem,3.2vw,1.2rem); opacity:1; transform:translateY(0)}
  #dhikrText.shake{animation:shake .30s ease}
  @keyframes shake{0%,100%{transform:translateX(0)}25%{transform:translateX(3px)}50%{transform:translateX(-3px)}75%{transform:translateX(2px)}}
  .bigShare{
    margin:12px auto 6px;width:min(80vw,280px);height:min(80vw,280px);border-radius:50%;border:none;
    display:grid;place-items:center;background:linear-gradient(145deg,var(--btn1),var(--btn2));color:#fff;font-weight:900;cursor:pointer;
    box-shadow:12px 12px 22px rgba(10,59,39,.75),-12px -12px 22px rgba(31,214,128,.2),inset 8px 8px 16px rgba(0,0,0,.35),inset -8px -8px 16px rgba(255,255,255,.07)
  }
  .visits{color:var(--muted);margin:8px 0}
  .confetti{position:fixed;inset:0;pointer-events:none;overflow:hidden;z-index:9999;display:none}
  .paper{position:absolute;width:8px;height:14px;border-radius:2px;opacity:.9;animation:fall 3.2s linear forwards}
  @keyframes fall{0%{transform:translateY(-10vh) rotate(0)}100%{transform:translateY(110vh) rotate(720deg)}}
</style>
</head>
<body>

<!-- البداية -->
<section id="start" class="wrap">
  <div class="card">
    <h2>بِسْمِ اللهِ الرَّحْمٰنِ الرَّحِيم</h2>
    <p class="muted">﴿ سَبِّّحِ اسْمَ رَبِّكَ الأَعْلَى ﴾</p>
    <button id="goBtn" class="btn">ابدأ</button>
  </div>
</section>

<!-- التسبيح -->
<section id="app" class="wrap">
  <div class="card">
    <h1>تسبيح وذكر الله</h1>
    <p class="muted">اضغط الحلقة 10 مرات، ثم شارك الأجر مع أحبابك</p>

    <div id="dhikrText">سبحان الله والحمد لله ولا إله إلا الله والله أكبر</div>

    <div id="ring" class="ring" style="--deg:0deg"><span>اضغط هنا</span></div>

    <div class="muted">المتبقي: <b id="left">10</b> / 10 — العدّاد: <b id="count">0</b></div>
  </div>
</section>

<!-- النهاية -->
<section id="end" class="wrap">
  <div class="card">
    <h2>جزاك الله خيرًا</h2>
    <p class="visits">زائروا الصفحة: <b id="visitors">—</b></p>
    <button id="shareBtn" class="bigShare">📤 شارك الأجر على واتساب</button>
  </div>
</section>

<!-- طبقة الكونفِتي -->
<div id="confetti" class="confetti"></div>

<script>
document.addEventListener('DOMContentLoaded', function(){

  const SHARE_URL = "https://share.google/y1S9s1xfewux5ikaA";
  const DHIKR = "سبحان الله والحمد لله ولا إله إلا الله والله أكبر";

  // شاشات
  const start = document.getElementById('start');
  const app   = document.getElementById('app');
  const end   = document.getElementById('end');

  // عناصر التسبيح
  const goBtn = document.getElementById('goBtn');
  const ring = document.getElementById('ring');
  const leftEl = document.getElementById('left');
  const countEl = document.getElementById('count');
  const dhikrEl = document.getElementById('dhikrText');

  // النهاية
  const visitorsEl = document.getElementById('visitors');
  const shareBtn = document.getElementById('shareBtn');
  const confettiLayer = document.getElementById('confetti');

  // انتقال من البداية للتسبيح
  goBtn.addEventListener('click', () => {
    start.style.display = 'none';
    app.style.display = 'block';
  });

  // حالة العدّ
  let target=10, left=10, count=0;

  // صوت بسيط
  let audioCtx=null;
  function beep(f=760,d=90,v=0.07){
    try{
      if(!audioCtx) audioCtx = new (window.AudioContext||window.webkitAudioContext)();
      const o=audioCtx.createOscillator(), g=audioCtx.createGain();
      o.type='sine'; o.frequency.value=f; g.gain.value=v; o.connect(g).connect(audioCtx.destination);
      const t=audioCtx.currentTime; o.start(t);
      g.gain.exponentialRampToValueAtTime(0.0001,t+d/1000); o.stop(t+d/1000+0.02);
    }catch(_){}
  }

  function setProgress(){ ring.style.setProperty('--deg', ((target-left)/target)*360 + 'deg'); }
  function showDhikr(){
    dhikrEl.textContent = DHIKR;
    dhikrEl.classList.remove('show','shake'); void dhikrEl.offsetWidth;
    dhikrEl.classList.add('show','shake');
  }

  ring.addEventListener('click', ()=>{
    if(left<=0) return;
    count++; left--;
    if(navigator.vibrate) navigator.vibrate(15);
    beep(700+Math.random()*60,70,0.08);
    showDhikr();
    leftEl.textContent = left;
    countEl.textContent = count;
    setProgress();
    if(left===0) showEnd();
  });

  shareBtn.addEventListener('click', ()=>{
    window.open("https://wa.me/?text=" + encodeURIComponent(SHARE_URL), "_blank", "noopener");
  });

  async function showEnd(){
    app.style.display='none';
    end.style.display='block';
    runConfetti(140, 3000);

    try{
      const r = await fetch('https://api.countapi.xyz/hit/tasbih-app/main-page-visitors',{cache:'no-store'});
      const d = await r.json();
      visitorsEl.textContent = (typeof d.value==='number') ? d.value.toLocaleString('ar-EG') : "—";
    }catch{ visitorsEl.textContent = "—"; }
  }

  function runConfetti(amount=120, duration=3000){
    confettiLayer.innerHTML = ""; confettiLayer.style.display = 'block';
    const colors = ["#fff176","#ffd54f","#ff8a65","#4dd0e1","#aed581","#ba68c8","#f06292","#fff"];
    const W = innerWidth, H = innerHeight;
    for(let i=0;i<amount;i++){
      const p = document.createElement('div');
      p.className = 'paper';
      p.style.left = (Math.random()*W) + 'px';
      p.style.top  = (-20 - Math.random()*H*0.3) + 'px';
      p.style.background = colors[(Math.random()*colors.length)|0];
      p.style.animationDelay = (Math.random()*0.8)+'s';
      p.style.transform = `translateY(-10vh) rotate(${Math.random()*360}deg)`;
      confettiLayer.appendChild(p);
    }
    setTimeout(()=>{ confettiLayer.style.display='none'; confettiLayer.innerHTML=""; }, duration);
  }

  // تهيئة
  setProgress();
});
</script>
</body>
</html>
